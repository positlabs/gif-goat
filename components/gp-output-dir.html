
<!-- 


-->

<dom-module id='gp-output-dir'>

	<style>
		
		:host {
			position: relative;
			-webkit-user-select: none;
		}

		.path {
			font-size: .8em;
			margin-left: 10px;
			transition: all .1s;
		}
		.path:hover {
			color: var(--light-green);
		}

	</style>
	
	<template>
		<span id='outputBtn' class='btn bubble' on-click='_onClickOutputBtn'>
			<span>save to</span>
			<span class='fa fa-folder-open'></span>
		</span>

		<span class='path btn' on-click='_onClickOpenOutputBtn' title='[[path]]'>
			<span id='path-display'></span>
			<span class='fa fa-external-link-square'></span>
		</span>
	</template>

	<script>(function(){

		var path = require('path');
		var shell = require('electron').shell;
		var paths = require('./modules/paths');

		Polymer({
			is: 'gp-output-dir',
			
			properties: {
				path: {
					type: String,
					value: '',
					observer: '_onPathChanged'
				}
			},

			ready(){
				this.path = localStorage.getItem('output-dir') || paths.desktop;
				ipc.on('request-output-dir', this._gotOutputDir.bind(this));
			},

			_onPathChanged(){
				var maxChars = 30;
				var chars = this.path;
				if(chars.length > maxChars){
					chars = chars.slice(chars.length - maxChars, chars.length);
					chars = '...' + chars;
				}
				this.$['path-display'].innerHTML = chars;
			},

			_onClickOpenOutputBtn(){
				// shell.openItem(this.path);
				// open in the damn foreground!
				shell.openExternal('file://'+this.path);
			},

			_onClickOutputBtn(){
				ipc.send('request-output-dir');
			},

			_gotOutputDir(event, outputDir){
				// console.log('_gotOutputDir', outputDir);
				this.path = outputDir;
				localStorage.setItem('output-dir', this.path);
			},

		});

	})();</script>

</dom-module>